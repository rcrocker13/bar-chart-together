<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Getting Started with D3</title>

		<script type="text/javascript" src="libs/jquery-ui/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="libs/jquery-ui/jquery-ui.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
		<script type="text/javascript" src="libs/bootstrap-select/js/bootstrap-select.js"></script>

		<link rel="stylesheet" href="libs/jquery-ui/jquery-ui.css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

		<style>
			header {
				padding-top: 15px;
				padding-left: 15px;
				background-color: #3D3D3D;
				color: #EEE;
			}
			footer {
				padding-top: 5px;
				padding-left: 5px;
				background-color: #3D3D3D;
				color: #EEE;
			}
			.start-header {
				margin-top: 10px;
			}
			.goal-header {
				margin-top: 10px;
			}
			.workspace {
				background-color: #EDEDEB;
			}
	    fieldset {
	      border: 0;
	    }
	    label {
	      display: block;
	      margin: 30px 0 0 0;
	    }
	    select {
	      width: 150px;
	    }
	    .overflow {
	      height: 200px;
	    }
			<!-- D3 Styles -->
			<!-- WHY DOES THIS HOVER NOT WORK WITHOUT INCLUDE THE RECT SELECTOR?
 			rect {
	      -moz-transition: all 0.5s;
	      -o-transition: all 0.5s;
	      -webkit-transition: all 0.5s;
	      transition: all 0.5s;
	      fill: orange;
			}
			.invisible:hover {
				fill: orange;
			}
			.axis path,
			.axis line {
				fill: none;
				stroke: #ccc;
				shape-rendering: auto;
			}
			.axis text {
				font-size: 8px;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<header class="col-md-12">
					<h1>Let's Build a Bar Chart... Together</h1>
				</header>
			</div>
			<div class="row">
				<div class="col-md-2">
					<h4>HTML</h4>
					<ul>
						<li>head</li>
						<li>meta</li>
						<li>body</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>CSS</h4>
					<ul>
						<li>selector</li>
						<li>values</li>
						<li>hover</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>JavaScript</h4>
					<ul>
						<li>variables</li>
						<li>functions</li>
						<li>AJAX</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>SVG</h4>
					<ul>
						<li>nesting</li>
						<li>rect</li>
						<li>properties</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>D3</h4>
					<ul>
						<li>data</li>
						<li>select, enter, append</li>
						<li>transition</li>
					</ul>
				</div>
			</div>
				<div class="row workspace">
					<div id="start" class="col-md-6">
						<div class="row start-header">
							<h5>Start</h5>
						</div>
					</div>
					<div id="goal" class="col-md-6">
						<div class="row goal-header">
							<div class="col-md-8">
								<h5>Goal</h5>
							</div>
							<div class="col-md-4">
								<!-- These are just like parameters in Tableau -->
								<select  id="goalSelection" class="pull-right" name="goalSelection">
									<option title="Bang!">Carburetors</option>
									<option>Cylinders</option>
									<option>Displacement</option>
									<option>Gears</option>
									<option>Horse Power</option>
									<option>Miles per Gallon</option>
									<option>Quarter Mile</option>
									<option>Weight</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<footer class="col-md-12">
					<p>
						For more information reachout to <a href="mailto:SFdataviz@slalom.com">SF Data Viz</a>.
					</p>
				</footer>
			</div>
		</div>
		<script>
			// render the jQuery dropdown element
		  $(function() {
		    $( "#goalSelection" ).selectmenu();
		 	});

			var margin = {top: 20, right: 10, bottom: 20, left: 100};
			var height = 450 - margin.top - margin.bottom;
			var width = 700 - margin.right - margin.left;
			var startSvg = d3.select("#start").append("svg")
				.attr("width", width)
				.attr("height", height)
				.style("border", "1px solid #ccc")
				.style("border-radius", "5px")
				.style("background-color", "#FFF");

			// Append Goals Bar Chart
			var goalSvg = d3.select("#goal").append("svg")
				.attr("width", width)
				.attr("height", height)
				.style("border", "1px solid #ccc")
				.style("border-radius", "5px")
				.style("background-color", "#FFF");

			d3.csv("mtcars.csv", function(data) {

				data = data.map(function(d) {

					return {
						car: d.car,
						mpg: +d.mpg,
						cylinders: +d.cyl,
						displacement: +d.disp,
						horsePower: +d.hp,
						drat: +d.drat,
						weight: +d.wt,
						quarterMile: +d.qt,
						vs: +d.vs,
						am: +d.am,
						gears: +d.gear,
						carburetors: +d.carb
					};

				});

				console.log(data);

				data.sort(function(a, b) {
					// If a > b then a - b will return a value > 0, gives a a higher index value than b.
					// a - b will sort values in ascending order.
					// b - a will sort values in descending order.
					return d3.ascending(a.horsePower,b.horsePower);
				});

				var xScale = d3.scale.linear()
					.domain(d3.extent(data, function(d) { return d.horsePower; }))
					.range([0, width]);

				var yScale = d3.scale.ordinal()
					.domain(data.map(function(d) { return d.car; }))
					.rangeBands([height, 0]);

				var yAxis = d3.svg.axis()
					.scale(yScale)
					.orient("left");

				goalSvg.selectAll("rect")
					.data(data).enter()
					.append("rect")
					.attr("class", "invisible bar")
					.attr("x", margin.left)
					.attr("y", function(d) { return yScale(d.car); })
					.attr("height", height / data.length - 2.5)
					.attr("width", width)
					.on("mouseover", function() {
		        d3.select(this)
		          .attr("fill", "orange");
					})
					.on("mouseout", function() {
		        d3.select(this)
		        	.transition()
		        	.duration(250)
		          .attr("fill", "steelblue");
					});

				var goalG = goalSvg.selectAll("g")
					.data(data).enter()
					.append("g")
					.attr("class", "bar")
					.attr("transform", function(d) { return "translate(0," + yScale(d.car) + ")"; });

				bars = goalG.append("rect")
					.attr("class", "bar")
					.attr("x", margin.left)
					.attr("height", height / data.length - 2.5)
					.attr("width", function(d) { return xScale(d.horsePower); })
					.attr("fill", "steelblue");

				goalSvg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate(" + margin.left + ",0)")
					.call(yAxis);

				// Trying to change values
				$("#goalSelection").on( "selectmenuchange", function() {

						var selection = $(".ui-selectmenu-text").html();

						data.sort(function(a, b) {
							// If a > b then a - b will return a value > 0, gives a a higher index value than b.
							// a - b will sort values in ascending order.
							// b - a will sort values in descending order.
							return a.selection - b.selection;
						});

						var xScale = d3.scale.linear()
							.domain(d3.extent(data, function(d) { return d.selection; }))
							.range([0, width]);

						bars
							.transition()
							.duration(500)
							.attr("width", function(d) { return xScale(d.selection); });

				});
			});

				// ***** TRY TO RESHUFFLE
				// d3.select("#goal").on("click", function() {

					// 	d3.selectAll("rect")
					// 		.update();

					// 	d3.csv("mtcars.csv", function(data) {

					// 		data = data.map(function(d) {

					// 			return {
					// 				car: d.car,
					// 				mpg: +d.mpg,
					// 				cylinders: +d.cyl,
					// 				displacement: +d.disp,
					// 				horsePower: +d.hp,
					// 				drat: +d.drat,
					// 				weight: +d.wt,
					// 				quarterMile: +d.qt,
					// 				vs: +d.vs,
					// 				am: +d.am,
					// 				gears: +d.gear,
					// 				carburetors: +d.carb
					// 			};
					// 		});

					// 		data.sort(function(a, b) {
					// 			return a.quarterMile - b.quarterMile;
					// 		});

					// 		var xScale = d3.scale.linear()
					// 			.domain(d3.extent(data, function(d) { return d.quarterMile; }))
					// 			.range([0, width]);

					// 		var yScale = d3.scale.ordinal()
					// 			.domain(data.map(function(d) { return d.car; }))
					// 			.rangeRoundBands([height, 0], 0, 1);

					// 		var goalG = goalSvg.selectAll("g")
					// 			.data(data).enter()
					// 			.append("g")
					// 			.attr("class", "bar")
					// 			.attr("transform", function(d) { return "translate(0," + yScale(d.car) + ")"; });

					// 		bars = goalG.append("rect")
					// 			.attr("x", margin.left)
					// 			.attr("height", height / data.length - 2.5)
					// 			.attr("width", function(d) { return xScale(d.quarterMile); })
					// 			.attr("fill", "steelblue");

					// 	});

				// });

			</script>
		</body>
</html>