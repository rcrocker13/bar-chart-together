<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Getting Started with D3</title>

		<script type="text/javascript" src="libs/jquery-ui/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="libs/jquery-ui/jquery-ui.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
		<script type="text/javascript" src="libs/bootstrap-select/js/bootstrap-select.js"></script>

		<link rel="stylesheet" href="libs/jquery-ui/jquery-ui.css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

		<style>
			body {
				font-family: monospace;
			}
			header {
				padding-left: 15px;
				background-color: #A68950;
			}
			header h1 {
				margin-bottom: 2px;
			}
			.references h4 {
				font-size: 12px;
				color: #536B7F;
			}
			.references {
				background-color: #F8ECC2;
				font-size: 10px;
				color: #536B7F;
			}
			footer {
				padding-top: 5px;
				background-color: #A68950;
			}
			footer p {
				padding-left: 20px;
			}
			.start-header {
				padding-left: 20px;
				margin-top: 10px;
				color: #536B7F;
			}
			.goal-header {
				margin-top: 10px;
				color: #536B7F;
			}
			#goalSelection {
				width: 180px;
			}
			.workspace {
				padding-bottom: 25px;
				background-color: #F8ECC2;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<header class="col-md-12">
					<h1>Let's Build a Bar Chart... Together</h1>
				</header>
			</div>
			<div class="row references">
				<div class="col-md-2">
					<h4>HTML</h4>
					<ul>
						<li>DOM</li>
						<li>head</li>
						<li>meta</li>
						<li><a href="http://cssguidelin.es/">style</a></li>
						<li>body</li>
						<li>script</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>CSS</h4>
					<ul>
						<li>selector</li>
						<li>property</li>
						<li>values</li>
						<li>The Cascade</li>
						<li><a href="http://learn.shayhowe.com/html-css/getting-to-know-css/"></a>Specificity Weight</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>JavaScript</h4>
					<ul>
						<li><a href="http://stackoverflow.com/questions/11576018/what-is-the-difference-between-a-javascript-framework-and-a-library">libraries</a></li>
						<li>variables</li>
						<li>functions</li>
						<li><a href="https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started">AJAX</a></li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>SVG</h4>
					<ul>
						<li>nesting</li>
						<li>shapes</li>
						<li>rect</li>
						<li>text</li>
						<li>advanced features</li>
					</ul>
				</div>
				<div class="col-md-2">
					<h4>D3</h4>
					<ul>
						<li>load data, transform, bind and style</li>
						<li>select, enter, update and append</li>
						<li>transition</li>
					</ul>
				</div>
			</div>
				<div class="row workspace">
					<div id="start" class="col-md-6">
						<div class="row start-header">
							<h4>Start</h4>
						</div>
					</div>
					<div id="goal" class="col-md-6">
						<div class="row goal-header">
							<div class="col-md-8">
								<h4>Goal</h4>
							</div>
							<div class="col-md-4">
								<!-- These are just like parameters in Tableau -->
								<select  id="goalSelection" class="pull-right" name="goalSelection">
									<option value="horsePower" selected>Horse Power</option>
									<option value="carburetors">Carburetors</option>
									<option value="cylinders">Cylinders</option>
									<option value="displacement">Displacement</option>
									<option value="gears">Gears</option>
									<option value="mpg">Miles per Gallon</option>
									<option value="qt">Quarter Mile</option>
									<option value="wt">Weight</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<footer class="col-md-12">
					<p>
						For more information reachout to <a href="mailto:SFdataviz@slalom.com">SF Data Viz</a>.
					</p>
				</footer>
			</div>
		</div>
		<script>
			// Render the Select Menu
		  $(function() {
		    $("#goalSelection").selectmenu();
		 	});

		  // Margin, height and width with be used in all of our charts
			var margin = {top: 10, right: 25, bottom: 20, left: 75};
			var height = 405 - margin.top - margin.bottom;
			var width = 700 - margin.right - margin.left;
			var startSvg = d3.select("#start").append("svg")
				.attr("width", width)
				.attr("height", height)
				.style("border", "1px solid #ccc")
				.style("border-radius", "5px")
				.style("background-color", "#FFF");

				// Set the scales and axis
				var xScale = d3.scale.linear()
					.range([0, width]);

				var xAxis = d3.svg.axis()
					.scale(xScale)
					.orient("bottom");

				var yScale = d3.scale.ordinal()
					.rangeBands([height, 0]);

				var yAxis = d3.svg.axis()
					.scale(yScale)
					.orient("left");

			// Append Goals Bar Chart
			var goalG = d3.select("#goal").append("svg")
					.attr("width", width)
					.attr("height", height)
					.style("border-radius", "5px")
					.style("background-color", "#FFF");

			var chart = goalG.append("g")
					.attr("transform","translate(" + margin.left + "," + margin.top + ")");

			// Load in the mtcars dataset
			d3.csv("mtcars.csv", function(data) {

				// Convert the strings to SVGs
				var mtcars = data.map(function(d) {

					return {
						car: d.car,
						mpg: +d.mpg,
						cylinders: +d.cyl,
						displacement: +d.disp,
						horsePower: +d.hp,
						weight: +d.wt,
						quarterMile: +d.qsec,
						gears: +d.gear,
						carburetors: +d.carb
					};

				});

				mtcars.sort(function(a,b) {
					return d3.ascending(a.horsePower,b.horsePower);
				});

				// Reset the scale and axis domains
				xScale
					.domain(d3.extent(mtcars, function(d) {
						return d.horsePower;
					}));

				yScale
					.domain(mtcars.map(function(d) {return d.car; }));

				// ENTER
				// Create new elements as needed
				var car = chart.selectAll("rect")
					.data(mtcars, function(d) { return d.car; });

			  car
					.enter().append("rect")
					.attr("y", function(d) { return yScale(d.car); })
					.attr("width", function(d) {
						if(xScale(d.horsePower) - margin.left < 0) {
							return 0;
						} else {
							return xScale(d.horsePower) - margin.left;
						}
					})
					.attr("height", function(d) { return height / data.length - 2; })
					.attr("fill", "none")
					.style("stroke", "#ccc");

				var text = chart.selectAll("text")
					.data(mtcars, function(d) { return d.car; });

			  text
					.enter().append("text")
					.attr("font-family", "Helvetica")
					.attr("font-size", "8px")
					.attr("fill", "#000")
					.attr("transform", function(d) {
						return "translate(-5," + (yScale(d.car) + 10) + ")";
					})
					.text(function(d) { return d.car; })
					.attr("text-anchor", "end");

				function update(data, selection) {

					// Let's standardize our data structure
					var slimData = [];

					if(selection) {
						data.forEach(function(car) {
							slimData.push({
								car: car.car,
								value: car[selection]
							});
						});
					} else {
						data.forEach(function(car) {
							slimData.push({
								car: car.car,
								value: car.horsePower
							});
						});
					}

					slimData.sort(function(a,b) {
						return d3.ascending(a.value,b.value);
					});

					// Reset the scale and axis domains
					xScale
						.domain(d3.extent(slimData, function(d) {
							return d.value;
						}));

					yScale
						.domain(slimData.map(function(d) {return d.car; }));

				  car
				  	.data(slimData, function(d) { return d.car; })
				  	.transition()
				  	.duration(750)
						.attr("y", function(d) { return yScale(d.car); })
						.attr("width", function(d, i) {
							if(xScale(d.value) - margin.left < 0) {
								return 0;
							} else {
								return xScale(d.value) - margin.left;
							}
						});

					text
						.data(slimData, function(d) { return d.car; })
						.transition()
						.duration(750)
						.attr("transform", function(d) {
							return "translate(-5," + (yScale(d.car) + 10) + ")";
						});

				}

				$("#goalSelection").on( "selectmenuchange", function() {

					switch($(".ui-selectmenu-text").text().toString().toLowerCase()) {
						case "miles per gallon":
							var selection = "mpg";
							break;
						case "horse power":
							var selection = "horsePower";
							break;
						case "quarter mile":
							var selection = "quarterMile";
							break;
						default:
							var selection = $(".ui-selectmenu-text").text().toString().toLowerCase();
					}

					update(mtcars, selection);

				});

			});

			</script>
		</body>
</html>